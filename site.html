<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desafio OISC - Hello World</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap');
        body { font-family: 'Fira Code', monospace; background-color: #0f172a; color: #e2e8f0; }
        .code-input { background: #1e293b; color: #38bdf8; border: 1px solid #334155; }
    </style>
</head>
<body class="p-8">
    <div class="max-w-4xl mx-auto">
        <header class="mb-8 border-b border-slate-700 pb-4">
            <h1 class="text-3xl font-bold text-sky-400">OISC Emulator (SUBLEQ)</h1>
            <p class="text-slate-400 mt-2">Instrucao: <code>SUBLEQ A, B, C</code> - Mem[B] = Mem[B] - Mem[A]; se Mem[B] <= 0, salta para C</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div>
                <h2 class="text-xl mb-4 font-semibold text-slate-200">Seu Codigo:</h2>
                <textarea id="editor" class="code-input w-full h-64 p-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500" placeholder="Ex: 10 10 3 ..."></textarea>
                
                <div class="mt-4 flex gap-4">
                    <button onclick="executar()" class="bg-sky-600 hover:bg-sky-500 text-white px-6 py-2 rounded-md font-bold transition">
                        RUN & VALIDATE
                    </button>
                    <button onclick="carregarExemplo()" class="text-slate-400 hover:text-white text-sm">
                        Carregar Template
                    </button>
                </div>
            </div>

            <div class="flex flex-col gap-4">
                <h2 class="text-xl font-semibold text-slate-200">Status:</h2>
                <div id="status" class="p-4 rounded-lg bg-slate-800 border border-slate-700 h-16 flex items-center italic text-slate-400">
                    Aguardando execucao...
                </div>

                <h2 class="text-xl font-semibold text-slate-200">Saida do Console:</h2>
                <div id="console" class="p-4 rounded-lg bg-black text-green-400 h-32 overflow-y-auto border border-slate-700 font-bold text-lg">
                    > _
                </div>
            </div>
        </div>

        <footer class="mt-12 bg-slate-800/50 p-6 rounded-xl border border-slate-700">
            <h3 class="text-sky-400 font-bold mb-2">Dica para o desafio:</h3>
            <p class="text-sm text-slate-300">
                Use o endereco <strong>-1</strong> para imprimir o caractere no endereco A.<br>
                Exemplo: <code>5 -1 3</code> imprime o caractere armazenado na posicao 5 da memoria e salta para a instrucao 3.
            </p>
        </footer>
    </div>

    <script>
    function executar() {
        const input = document.getElementById('editor').value;
        const statusDiv = document.getElementById('status');
        const consoleDiv = document.getElementById('console');

        // 1. Parsing do código
        const raw = input.trim();
        if (!raw) {
            statusDiv.innerHTML = "Erro: o código deve conter apenas números.";
            statusDiv.className = "p-4 rounded-lg bg-red-900/30 border border-red-500 h-16 flex items-center text-red-400";
            return;
        }

        const tokens = raw.split(/\s+/);
        const memoria = tokens.map(Number);

        if (memoria.some(Number.isNaN)) {
            statusDiv.innerHTML = "Erro: o código deve conter apenas números.";
            statusDiv.className = "p-4 rounded-lg bg-red-900/30 border border-red-500 h-16 flex items-center text-red-400";
            return;
        }

        // --- ADAPTAÇÃO PARA COMPATIBILIDADE COM C ---
        let pc = 0; // No C, o PC sempre inicia em 0, sem busca automática
        // --------------------------------------------

        let output = "";
        let ciclos = 0;
        const MAX_CICLOS = 5000;

        // 2. Loop de Execução
        while (pc >= 0 && pc < memoria.length && ciclos < MAX_CICLOS) {
            const a = memoria[pc];
            const b = memoria[pc + 1];
            const c = memoria[pc + 2];

            // Proteção contra instrução incompleta (mínimo 3 valores)
            if (pc + 2 >= memoria.length) break;

            // IO Mapeado (Lógica compatível com C)
            if (b === -1) {
                const val = memoria[a] ?? 0;
                output += String.fromCharCode(val);
                
                // --- ADAPTAÇÃO PARA COMPATIBILIDADE COM C ---
                // No seu código C, pc = pc + 3 após imprimir, ignorando o salto 'c'
                pc += 3; 
                // --------------------------------------------
            } else {
                // Lógica SUBLEQ Padrão
                const valA = memoria[a] ?? 0;
                const valB = memoria[b] ?? 0;

                memoria[b] = valB - valA;

                if (memoria[b] <= 0) {
                    pc = c;
                } else {
                    pc += 3;
                }
            }
            
            // No C, pc < 0 é usado como "System Halt"
            if (pc < 0) break;
            
            ciclos++;
        }

        // 3. Atualizar UI
        consoleDiv.innerText = "> " + (output || "(nada foi impresso)");

        const normalized = output.trim();
        if (normalized === "Hello, world!") {
            statusDiv.innerHTML = "Sucesso! Você imprimiu 'Hello, world!'.";
            statusDiv.className = "p-4 rounded-lg bg-green-900/30 border border-green-500 h-16 flex items-center text-green-400";
        } else {
            statusDiv.innerHTML = "Falhou ou em execução. Verifique a saída.";
            statusDiv.className = "p-4 rounded-lg bg-yellow-900/30 border border-yellow-500 h-16 flex items-center text-yellow-400";
        }
    }

    function carregarExemplo() {
        // Exemplo de Hello World compatível com a lógica C
        // Estrutura: Instruções primeiro (PC=0), Dados depois.
        const code = `
15 17 -1 
17 -1 -1 
16 1 -1 
16 3 -1 
15 15 0 
0 -1 72
101 108 108 
111 44 32 
119 111 114 
108 100 33 
10 0 0`; 
        // Nota: O exemplo acima é ilustrativo para mostrar o início no PC 0.
        document.getElementById('editor').value = code.trim();
    }
</script>
</body>
</html>